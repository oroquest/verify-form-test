<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Sikura Verifizierung</title>
  <link rel="stylesheet" href="style.css">
  <script src="script.js" defer></script>
</head>
<body>
  <div class="container">
    <img src="siku_logo.png" alt="Sikura Life Logo" class="logo"/>
    <h2 data-i18n="title">Bitte bestätigen Sie Ihre Daten</h2>

    <form id="verify-form">
      <div class="language-switcher">
        <select id="language" onchange="setLanguage(this.value)">
          <option value="de">Deutsch</option>
          <option value="it">Italiano</option>
          <option value="en">English</option>
        </select>
      </div>

      <label for="glaeubiger" data-i18n="glaeubiger">Gläubiger-Nr.</label>
      <input type="text" id="glaeubiger" name="glaeubiger" readonly required />

      <label for="vorname" data-i18n="firstname">Vorname</label>
      <input type="text" id="vorname" name="vorname" required />

      <label for="name" data-i18n="name">Name</label>
      <input type="text" id="name" name="name" required />

      <label for="strasse" data-i18n="strasse">Strasse</label>
      <input type="text" id="strasse" name="strasse" required />

      <label for="hausnummer" data-i18n="hausnummer">Hausnummer</label>
      <input type="text" id="hausnummer" name="hausnummer" required />

      <label for="plz" data-i18n="plz">PLZ</label>
      <input type="text" id="plz" name="plz" required />

      <label for="ort" data-i18n="ort">Ort</label>
      <input type="text" id="ort" name="ort" required />

      <label for="land" data-i18n="land">Land</label>
      <input type="text" id="land" name="land" required />

      <button type="submit" data-i18n="submit">Absenden</button>
    </form>
  </div>
</body>
<script>
document.getElementById('verify-form').addEventListener('submit', async (e) => {
  e.preventDefault();
  const params = new URLSearchParams(window.location.search);
  const id = params.get('id');
  const token = params.get('token');
  const email = atob(params.get('em'));

  const payload = {
    id,
    token,
    email,
    vorname: document.getElementById('vorname').value,
    name: document.getElementById('name').value,
    strasse: document.getElementById('strasse').value,
    hausnummer: document.getElementById('hausnummer').value,
    plz: document.getElementById('plz').value,
    ort: document.getElementById('ort').value,
    land: document.getElementById('land').value
  };

  const resp = await fetch('/.netlify/functions/verify_submit', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify(payload)
  });

  const data = await resp.json();
  if (data.ok) {
    window.location.href = "https://verify.sikuralife.com/danke.html";
  } else {
    alert("Fehler: " + (data.error || 'Unbekannt'));
  }
});
</script>
</html>
